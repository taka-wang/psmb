build:
    psmb_goclient:
        image: takawang/ubuntu-drone-psmb
        commands:
            # mbd
            - git clone https://github.com/taka-wang/modbusd.git
            - mkdir -p modbusd/build
            - cd modbusd/build
            - cmake .. && make && make install
            - cd ..
            - cp "config/service.sh" "/etc/init.d/modbusd" && chmod +x /etc/init.d/modbusd && update-rc.d modbusd defaults
            - service modbusd start
            - cd tests/cmbserver
            - gcc server.c -o server -Wall -std=c99 `pkg-config --libs --cflags libmodbus`
            - ./server &
            - ./server 503 &
            - cd ../../../

            # psmb
            
            - go get github.com/takawang/zmq3
            - go get github.com/taka-wang/gocron
            - go get github.com/takawang/sugar
            - go get github.com/takawang/logrus
            - go test -v


            # goclient
            - go get github.com/taka-wang/psmb
            - cd test/goclient/
            - go test -v
