sudo: required

services:
- docker

before_install:
# set timezone
- export TZ=Asia/Taipei

install:
# login to dockerhub
- docker login --email=$DOCKER_HUB_EMAIL --username=takawang --password=$DOCKER_HUB_PASSWORD

script:

### build modbus slave server image
- docker build -t $MODBUS_IMG test/mb/.
- if [ ! -z "$TRAVIS_TAG" ]; then docker tag $MODBUS_IMG:latest $MODBUS_IMG:$TRAVIS_TAG; fi && docker push $MODBUS_IMG

### build psmb image
- docker build -t $PSMB_IMG .
- if [ ! -z "$TRAVIS_TAG" ]; then docker tag $PSMB_IMG:latest $PSMB_IMG:$TRAVIS_TAG; fi && docker push $PSMB_IMG

### run modbus
- docker run -v /tmp:/tmp -itd --name=$MODBUS_NAME $MODBUS_IMG

### run psmb
- docker run -v /tmp:/tmp -it --name=$PSBM_NAME $PSMB_IMG

### stop all containers
- docker stop $MODBUS_NAME $PSBM_NAME

env:
  global:

  - MODBUS_IMG=takawang/mbd
  - MODBUS_NAME=mbd
  - PSMB_IMG=takawang/psmb
  - PSBM_NAME=psmb

notifications:
  email: false