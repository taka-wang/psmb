
machine:
    services:
        - docker

dependencies:
    pre:
        - sudo pip install docker-compose
    override:
        # './...' is a relative pattern which means all subdirectories
        - go get -t -d -v ./...
        - go build -v

test:
    pre:
        - go test -v -coverprofile=coverage.txt -covermode=atomic 
        # test psmb
        - docker build --no-cache=true . 
        # ci
        - docker-compose rm -f -a
        - docker-compose pull
        - docker-compose build
    override:
        - docker-compose up --abort-on-container-exit
    post:
        - bash <(curl -s https://codecov.io/bash) -t 558aa53d-c58d-4df4-a1c1-a22a6e6d8572
        - docker-compose stop
        - docker-compose rm -f -a